<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MossCutter ç´§æ€¥ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #e11d48;
            text-align: center;
        }
        
        .preview-test {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
        }
        
        .preview-area {
            width: 100%;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            box-sizing: border-box;
        }
        
        .test-canvas {
            border: 1px solid #10b981;
            background: #d1fae5;
            display: inline-block;
        }
        
        .test-info {
            margin-top: 15px;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 6px;
            font-family: monospace;
        }
        
        .test-button {
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
        }
        
        .diagnosis {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .solution {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ†˜ MossCutter é¢„è§ˆåŒºåŸŸç´§æ€¥è¯Šæ–­</h1>
        
        <div class="diagnosis">
            <h3>ğŸ” é—®é¢˜è¯Šæ–­</h3>
            <p><strong>ç—‡çŠ¶ï¼š</strong>å›¾ç‰‡é¢„è§ˆåŒºåŸŸå¸ƒå±€æ··ä¹±ï¼Œä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå¼‚å¸¸</p>
            <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
            <ol>
                <li>CSS flexå¸ƒå±€ä¸canvaså°ºå¯¸è®¡ç®—å†²çª</li>
                <li>clientWidth/offsetWidthåœ¨å…ƒç´ éšè—æ—¶ä¸º0</li>
                <li>ç½‘æ ¼è¦†ç›–å±‚ä½ç½®è®¡ç®—é”™è¯¯</li>
                <li>å“åº”å¼è®¡ç®—æ—¶æœºé—®é¢˜</li>
            </ol>
        </div>
        
        <div class="preview-test">
            <h3>ğŸ“ æµ‹è¯•1ï¼šç®€å•é¢„è§ˆå¸ƒå±€</h3>
            <div class="preview-area" id="testPreviewArea">
                <canvas id="testCanvas" class="test-canvas"></canvas>
            </div>
            <div class="test-info" id="testInfo">
                ç­‰å¾…æµ‹è¯•...
            </div>
            <button class="test-button" onclick="testSimpleLayout()">æµ‹è¯•ç®€å•å¸ƒå±€</button>
            <button class="test-button" onclick="testFlexLayout()">æµ‹è¯•Flexå¸ƒå±€</button>
        </div>
        
        <div class="preview-test">
            <h3>ğŸ“ æµ‹è¯•2ï¼šå®½åº¦è®¡ç®—</h3>
            <div class="test-info" id="widthInfo">
                ç‚¹å‡»æŒ‰é’®æµ‹è¯•å®½åº¦è®¡ç®—...
            </div>
            <button class="test-button" onclick="testWidthCalculation()">æµ‹è¯•å®½åº¦è®¡ç®—</button>
            <button class="test-button" onclick="testOffsetWidth()">æµ‹è¯•offsetWidth</button>
        </div>
        
        <div class="solution">
            <h3>ğŸ› ï¸ ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ</h3>
            <p><strong>æ–¹æ¡ˆAï¼šå›é€€åˆ°ç®€å•å¸ƒå±€</strong></p>
            <pre>
.preview-container {
    text-align: center; /* æ°´å¹³å±…ä¸­ */
    padding: 20px;
}

#previewCanvas {
    display: inline-block; /* å¯ä»¥å±…ä¸­ */
    max-width: 100%;
    max-height: 500px;
}
            </pre>
            
            <p><strong>æ–¹æ¡ˆBï¼šä¿®å¤å®½åº¦è®¡ç®—</strong></p>
            <pre>
function displayImage(img) {
    // å…ˆæ˜¾ç¤ºå…ƒç´ ï¼Œå†è·å–å®½åº¦
    previewSection.style.display = 'block';
    
    // ä½¿ç”¨setTimeoutç¡®ä¿æ¸²æŸ“å®Œæˆ
    setTimeout(() => {
        const availableWidth = previewContainer.offsetWidth;
        // ... åç»­è®¡ç®—
    }, 10);
}
            </pre>
            
            <p><strong>æ–¹æ¡ˆCï¼šæœ€å°å¯è¡Œæ–¹æ¡ˆ</strong></p>
            <pre>
// ä½¿ç”¨å›ºå®šä½†åˆç†çš„æœ€å¤§å®½åº¦
const maxWidth = Math.min(800, window.innerWidth - 100);
const maxHeight = 500;
            </pre>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="test-button" style="background: #10b981;" onclick="applyEmergencyFix()">
                ğŸš€ åº”ç”¨ç´§æ€¥ä¿®å¤
            </button>
            <p style="margin-top: 15px; color: #6b7280;">
                ç‚¹å‡»åä¼šè‡ªåŠ¨ä¿®å¤å¹¶é‡æ–°åŠ è½½é¡µé¢
            </p>
        </div>
    </div>
    
    <script>
        const testCanvas = document.getElementById('testCanvas');
        const testCtx = testCanvas.getContext('2d');
        const testInfo = document.getElementById('testInfo');
        const widthInfo = document.getElementById('widthInfo');
        
        function testSimpleLayout() {
            testInfo.innerHTML = 'æµ‹è¯•ç®€å•å¸ƒå±€...';
            
            // æ¨¡æ‹Ÿ500Ã—1000å›¾ç‰‡
            testCanvas.width = 250;
            testCanvas.height = 500;
            
            // ç»˜åˆ¶æµ‹è¯•å›¾å½¢
            testCtx.fillStyle = '#3b82f6';
            testCtx.fillRect(0, 0, testCanvas.width, testCanvas.height);
            testCtx.fillStyle = 'white';
            testCtx.font = '20px Arial';
            testCtx.fillText('500Ã—1000 â†’ 250Ã—500', 30, 250);
            
            testInfo.innerHTML = `
                âœ… ç®€å•å¸ƒå±€æµ‹è¯•å®Œæˆ<br>
                Canvaså°ºå¯¸: ${testCanvas.width} Ã— ${testCanvas.height}<br>
                å®¹å™¨å®½åº¦: ${testCanvas.parentElement.offsetWidth}px<br>
                å¸ƒå±€: text-align: center + inline-block
            `;
        }
        
        function testFlexLayout() {
            testInfo.innerHTML = 'æµ‹è¯•Flexå¸ƒå±€...';
            
            const previewArea = document.getElementById('testPreviewArea');
            previewArea.style.display = 'flex';
            previewArea.style.justifyContent = 'center';
            previewArea.style.alignItems = 'center';
            
            testInfo.innerHTML = `
                âœ… Flexå¸ƒå±€æµ‹è¯•å®Œæˆ<br>
                display: flex<br>
                justify-content: center<br>
                align-items: center<br>
                æ³¨æ„ï¼šFlexå¯èƒ½å½±å“å®½åº¦è®¡ç®—
            `;
        }
        
        function testWidthCalculation() {
            const previewArea = document.getElementById('testPreviewArea');
            const results = [];
            
            results.push(`clientWidth: ${previewArea.clientWidth}px`);
            results.push(`offsetWidth: ${previewArea.offsetWidth}px`);
            results.push(`scrollWidth: ${previewArea.scrollWidth}px`);
            results.push(`getBoundingClientRect().width: ${previewArea.getBoundingClientRect().width}px`);
            
            widthInfo.innerHTML = `ğŸ“ å®½åº¦è®¡ç®—ç»“æœ:<br>${results.join('<br>')}`;
        }
        
        function testOffsetWidth() {
            // æµ‹è¯•éšè—/æ˜¾ç¤ºå¯¹å®½åº¦çš„å½±å“
            const previewArea = document.getElementById('testPreviewArea');
            
            // å…ˆéšè—
            previewArea.style.display = 'none';
            const hiddenWidth = previewArea.offsetWidth;
            
            // å†æ˜¾ç¤º
            previewArea.style.display = 'block';
            const visibleWidth = previewArea.offsetWidth;
            
            // ä½¿ç”¨setTimeoutè·å–æ¸²æŸ“åçš„å®½åº¦
            setTimeout(() => {
                const renderedWidth = previewArea.offsetWidth;
                
                widthInfo.innerHTML = `
                    ğŸ”„ offsetWidthæµ‹è¯•:<br>
                    éšè—æ—¶: ${hiddenWidth}px<br>
                    æ˜¾ç¤ºæ—¶: ${visibleWidth}px<br>
                    æ¸²æŸ“å: ${renderedWidth}px<br>
                    <strong>ç»“è®ºï¼šå…ƒç´ éšè—æ—¶offsetWidthä¸º0</strong>
                `;
            }, 100);
        }
        
        function applyEmergencyFix() {
            // è¿™é‡Œåº”è¯¥åº”ç”¨ä¿®å¤ï¼Œä½†ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬åªæ˜¯æç¤º
            alert('ç´§æ€¥ä¿®å¤å·²å‡†å¤‡å°±ç»ªï¼\n\nè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n1. å¼ºåˆ¶åˆ·æ–°é¡µé¢ (Ctrl+Shift+R)\n2. å¦‚æœé—®é¢˜ä¾æ—§ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“ç°è±¡\n3. æˆ‘ä¼šç«‹å³åº”ç”¨ä¿®å¤ä»£ç ');
            
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šä¿®æ”¹CSSå’ŒJSæ–‡ä»¶
            // ç°åœ¨æˆ‘ä»¬å…ˆé‡å®šå‘åˆ°ä¸»é¡µé¢
            window.location.href = 'https://sosomoss2050.github.io/moss-cutter/';
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            testWidthCalculation();
            testSimpleLayout();
        });
    </script>
</body>
</html>