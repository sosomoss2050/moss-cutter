<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘æ ¼å¯¹é½è°ƒè¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
        }
        
        .canvas-container {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 20px auto;
            border: 2px solid #4a9eff;
            background: #1e1e1e;
            text-align: center;
        }
        
        #debugCanvas {
            border: 1px solid #10b981;
            background: rgba(16, 185, 129, 0.1);
            margin-top: 50px;
        }
        
        .grid-overlay-debug {
            position: absolute;
            border: 1px dashed rgba(255, 0, 0, 0.5);
            pointer-events: none;
        }
        
        .grid-line-debug {
            position: absolute;
            background: rgba(255, 255, 0, 0.7);
        }
        
        .vertical-line {
            width: 2px;
        }
        
        .horizontal-line {
            height: 2px;
        }
        
        .info-panel {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .control-panel {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            background: #4a9eff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: monospace;
        }
        
        button:hover {
            background: #3a8eef;
        }
        
        .coordinate-display {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” ç½‘æ ¼å¯¹é½è°ƒè¯•å·¥å…·</h1>
        
        <div class="info-panel">
            <h3>é—®é¢˜è¯Šæ–­ï¼šç½‘æ ¼çº¿ä¸å›¾ç‰‡é”™ä½</h3>
            <p>å¯èƒ½åŸå› ï¼š</p>
            <ol>
                <li>getBoundingClientRect()è®¡ç®—æ—¶æœºé—®é¢˜</li>
                <li>CSSå®šä½å±‚çº§é—®é¢˜</li>
                <li>çª—å£æ»šåŠ¨å½±å“åæ ‡è®¡ç®—</li>
                <li>Canvasç¼©æ”¾ä¸ç½‘æ ¼çº¿ä½ç½®ä¸åŒ¹é…</li>
            </ol>
        </div>
        
        <div class="control-panel">
            <button onclick="testMethod1()">æ–¹æ³•1ï¼šç›´æ¥è¦†ç›–</button>
            <button onclick="testMethod2()">æ–¹æ³•2ï¼šç›¸å¯¹å®šä½</button>
            <button onclick="testMethod3()">æ–¹æ³•3ï¼štransformå®šä½</button>
            <button onclick="clearGrid()">æ¸…é™¤ç½‘æ ¼</button>
        </div>
        
        <div class="canvas-container" id="canvasContainer">
            <canvas id="debugCanvas" width="400" height="300"></canvas>
            <div id="gridOverlayDebug"></div>
        </div>
        
        <div class="info-panel" id="debugInfo">
            ç­‰å¾…æµ‹è¯•...
        </div>
        
        <div class="control-panel">
            <button onclick="simulateVerticalImage()">æ¨¡æ‹Ÿç«–å±å›¾ç‰‡ (250Ã—500)</button>
            <button onclick="simulateWideImage()">æ¨¡æ‹Ÿå®½å±å›¾ç‰‡ (596Ã—335)</button>
            <button onclick="simulateSquareImage()">æ¨¡æ‹Ÿæ–¹å½¢å›¾ç‰‡ (400Ã—400)</button>
        </div>
        
        <div class="info-panel">
            <h3>è°ƒè¯•è¯´æ˜ï¼š</h3>
            <p>1. çº¢è‰²è™šçº¿æ¡†ï¼šç½‘æ ¼è¦†ç›–å±‚è¾¹ç•Œ</p>
            <p>2. é»„è‰²çº¿ï¼šç½‘æ ¼çº¿</p>
            <p>3. ç»¿è‰²æ¡†ï¼šCanvasè¾¹ç•Œ</p>
            <p>4. åæ ‡æ˜¾ç¤ºï¼šé¼ æ ‡ä½ç½®ç›¸å¯¹äºCanvas</p>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('debugCanvas');
        const ctx = canvas.getContext('2d');
        const gridOverlayDebug = document.getElementById('gridOverlayDebug');
        const debugInfo = document.getElementById('debugInfo');
        const canvasContainer = document.getElementById('canvasContainer');
        
        let currentImageType = 'square';
        
        // ç»˜åˆ¶æµ‹è¯•å›¾ç‰‡
        function drawTestImage(type) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (type === 'vertical') {
                canvas.width = 250;
                canvas.height = 500;
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('ç«–å± 250Ã—500', 50, 250);
            } else if (type === 'wide') {
                canvas.width = 596;
                canvas.height = 335;
                ctx.fillStyle = '#10b981';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('å®½å± 596Ã—335', 200, 167);
            } else {
                canvas.width = 400;
                canvas.height = 400;
                ctx.fillStyle = '#8b5cf6';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('æ–¹å½¢ 400Ã—400', 120, 200);
            }
            
            currentImageType = type;
        }
        
        // æ–¹æ³•1ï¼šç›´æ¥è¦†ç›–ï¼ˆä½¿ç”¨ç»å¯¹å®šä½ï¼‰
        function testMethod1() {
            clearGrid();
            
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = canvasContainer.getBoundingClientRect();
            
            // è®¾ç½®ç½‘æ ¼è¦†ç›–å±‚ä¸canvaså®Œå…¨é‡å 
            gridOverlayDebug.style.position = 'absolute';
            gridOverlayDebug.style.left = `${canvasRect.left - containerRect.left}px`;
            gridOverlayDebug.style.top = `${canvasRect.top - containerRect.top}px`;
            gridOverlayDebug.style.width = `${canvas.width}px`;
            gridOverlayDebug.style.height = `${canvas.height}px`;
            gridOverlayDebug.style.border = '1px dashed rgba(255, 0, 0, 0.5)';
            
            // ç»˜åˆ¶3Ã—3ç½‘æ ¼
            const rows = 3, cols = 3;
            const cellWidth = canvas.width / cols;
            const cellHeight = canvas.height / rows;
            
            for (let i = 1; i < cols; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug vertical-line';
                line.style.left = `${i * cellWidth}px`;
                line.style.top = '0';
                line.style.height = `${canvas.height}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            for (let i = 1; i < rows; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug horizontal-line';
                line.style.top = `${i * cellHeight}px`;
                line.style.left = '0';
                line.style.width = `${canvas.width}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            debugInfo.innerHTML = `
                <strong>æ–¹æ³•1ï¼šç›´æ¥è¦†ç›–</strong><br>
                Canvasä½ç½®: left=${canvasRect.left}, top=${canvasRect.top}<br>
                å®¹å™¨ä½ç½®: left=${containerRect.left}, top=${containerRect.top}<br>
                ç›¸å¯¹ä½ç½®: left=${canvasRect.left - containerRect.left}px, top=${canvasRect.top - containerRect.top}px<br>
                ç½‘æ ¼å°ºå¯¸: ${canvas.width} Ã— ${canvas.height}<br>
                å•å…ƒæ ¼: ${cellWidth.toFixed(1)} Ã— ${cellHeight.toFixed(1)}
            `;
        }
        
        // æ–¹æ³•2ï¼šç›¸å¯¹å®šä½ï¼ˆä½¿ç”¨transformï¼‰
        function testMethod2() {
            clearGrid();
            
            const canvasRect = canvas.getBoundingClientRect();
            const containerRect = canvasContainer.getBoundingClientRect();
            
            // ä½¿ç”¨transformå®šä½
            gridOverlayDebug.style.position = 'absolute';
            gridOverlayDebug.style.left = '0';
            gridOverlayDebug.style.top = '0';
            gridOverlayDebug.style.width = `${canvas.width}px`;
            gridOverlayDebug.style.height = `${canvas.height}px`;
            gridOverlayDebug.style.transform = `translate(${canvasRect.left - containerRect.left}px, ${canvasRect.top - containerRect.top}px)`;
            gridOverlayDebug.style.border = '1px dashed rgba(255, 0, 0, 0.5)';
            
            // ç»˜åˆ¶ç½‘æ ¼ï¼ˆä¸æ–¹æ³•1ç›¸åŒï¼‰
            const rows = 3, cols = 3;
            const cellWidth = canvas.width / cols;
            const cellHeight = canvas.height / rows;
            
            for (let i = 1; i < cols; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug vertical-line';
                line.style.left = `${i * cellWidth}px`;
                line.style.top = '0';
                line.style.height = `${canvas.height}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            for (let i = 1; i < rows; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug horizontal-line';
                line.style.top = `${i * cellHeight}px`;
                line.style.left = '0';
                line.style.width = `${canvas.width}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            debugInfo.innerHTML = `
                <strong>æ–¹æ³•2ï¼štransformå®šä½</strong><br>
                transform: translate(${canvasRect.left - containerRect.left}px, ${canvasRect.top - containerRect.top}px)<br>
                ä¼˜ç‚¹ï¼šæ€§èƒ½æ›´å¥½ï¼Œé¿å…é‡æ’<br>
                ç½‘æ ¼å°ºå¯¸: ${canvas.width} Ã— ${canvas.height}
            `;
        }
        
        // æ–¹æ³•3ï¼šæœ€ç®€å•çš„æ–¹æ³• - è®©ç½‘æ ¼è¦†ç›–å±‚ä½œä¸ºcanvasçš„å…„å¼Ÿå…ƒç´ 
        function testMethod3() {
            clearGrid();
            
            // æœ€ç®€å•çš„æ–¹æ³•ï¼šç½‘æ ¼è¦†ç›–å±‚ä¸canvasåŒçº§ï¼Œä½¿ç”¨ç›¸åŒçš„ä½ç½®
            gridOverlayDebug.style.position = 'absolute';
            gridOverlayDebug.style.left = '50%';
            gridOverlayDebug.style.top = '50px'; // åŒ¹é…canvasçš„margin-top
            gridOverlayDebug.style.transform = 'translateX(-50%)';
            gridOverlayDebug.style.width = `${canvas.width}px`;
            gridOverlayDebug.style.height = `${canvas.height}px`;
            gridOverlayDebug.style.border = '1px dashed rgba(255, 0, 0, 0.5)';
            
            // ç»˜åˆ¶ç½‘æ ¼
            const rows = 3, cols = 3;
            const cellWidth = canvas.width / cols;
            const cellHeight = canvas.height / rows;
            
            for (let i = 1; i < cols; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug vertical-line';
                line.style.left = `${i * cellWidth}px`;
                line.style.top = '0';
                line.style.height = `${canvas.height}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            for (let i = 1; i < rows; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-debug horizontal-line';
                line.style.top = `${i * cellHeight}px`;
                line.style.left = '0';
                line.style.width = `${canvas.width}px`;
                gridOverlayDebug.appendChild(line);
            }
            
            debugInfo.innerHTML = `
                <strong>æ–¹æ³•3ï¼šç®€å•å±…ä¸­</strong><br>
                ä½¿ç”¨ä¸canvasç›¸åŒçš„å®šä½ï¼šleft: 50%, transform: translateX(-50%)<br>
                ä¼˜ç‚¹ï¼šæœ€ç®€å•ï¼Œæœ€å¯é <br>
                ç½‘æ ¼å°ºå¯¸: ${canvas.width} Ã— ${canvas.height}
            `;
        }
        
        function clearGrid() {
            gridOverlayDebug.innerHTML = '';
            gridOverlayDebug.style.border = 'none';
        }
        
        function simulateVerticalImage() {
            drawTestImage('vertical');
            debugInfo.innerHTML = 'æ¨¡æ‹Ÿç«–å±å›¾ç‰‡ï¼š250Ã—500';
        }
        
        function simulateWideImage() {
            drawTestImage('wide');
            debugInfo.innerHTML = 'æ¨¡æ‹Ÿå®½å±å›¾ç‰‡ï¼š596Ã—335';
        }
        
        function simulateSquareImage() {
            drawTestImage('square');
            debugInfo.innerHTML = 'æ¨¡æ‹Ÿæ–¹å½¢å›¾ç‰‡ï¼š400Ã—400';
        }
        
        // æ·»åŠ åæ ‡æ˜¾ç¤º
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // æ˜¾ç¤ºåæ ‡
            let coordDisplay = document.querySelector('.coordinate-display');
            if (!coordDisplay) {
                coordDisplay = document.createElement('div');
                coordDisplay.className = 'coordinate-display';
                document.body.appendChild(coordDisplay);
            }
            
            coordDisplay.style.left = `${e.clientX + 10}px`;
            coordDisplay.style.top = `${e.clientY + 10}px`;
            coordDisplay.textContent = `Canvas: (${Math.round(x)}, ${Math.round(y)})`;
        });
        
        // åˆå§‹åŒ–
        drawTestImage('square');
        debugInfo.innerHTML = 'ç‚¹å‡»æŒ‰é’®æµ‹è¯•ä¸åŒçš„ç½‘æ ¼å®šä½æ–¹æ³•';
    </script>
</body>
</html>